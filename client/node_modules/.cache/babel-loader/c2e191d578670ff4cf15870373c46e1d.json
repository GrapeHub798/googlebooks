{"ast":null,"code":"var _jsxFileName = \"D:\\\\Code\\\\googlebooks\\\\client\\\\src\\\\pages\\\\home\\\\home.jsx\";\nimport React, { Component } from 'react';\nimport { Row, Col, Form, Button } from 'react-bootstrap';\nimport BooksApi from '../../api/books.api';\nimport { BookErrors } from '../../shared/messages.error';\nimport BookModel from '../../model/book.model';\nimport { connect } from 'react-redux';\nimport AppList from '../../components/list/list';\nimport { updateBooks, setFavorites } from \"../../redux/actions\";\nimport BookCollection from \"../../model/bookcollection.model\";\nimport paginationService from \"../../services/pagination.service\";\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport Typography from '@material-ui/core/Typography';\nimport { fade, withStyles } from \"@material-ui/core/styles\";\nimport FavoriteApi from \"../../api/favorite.api\";\n\nconst mapStateToProps = state => {\n  const storeProps = {};\n\n  for (const [key, value] of Object.entries(state)) {\n    storeProps[key] = value;\n  }\n\n  return {\n    storeProps\n  };\n};\n\nconst mapDispatchToProps = dispatch => ({\n  updateBooks: bookUpdate => new Promise((resolve, reject) => {\n    dispatch(updateBooks(bookUpdate));\n    resolve();\n  }),\n  setFavorites: favorites => {\n    dispatch(setFavorites(favorites));\n  }\n});\n\nconst useStyles = theme => ({\n  grow: {\n    flexGrow: 1\n  },\n  menuButton: {\n    marginRight: theme.spacing(2)\n  },\n  title: {\n    display: 'none',\n    [theme.breakpoints.up('sm')]: {\n      display: 'block'\n    }\n  },\n  search: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    backgroundColor: fade(theme.palette.common.white, 0.15),\n    '&:hover': {\n      backgroundColor: fade(theme.palette.common.white, 0.25)\n    },\n    marginRight: theme.spacing(2),\n    marginLeft: 0,\n    width: '100%',\n    [theme.breakpoints.up('sm')]: {\n      marginLeft: theme.spacing(3),\n      width: 'auto'\n    }\n  },\n  searchIcon: {\n    padding: theme.spacing(0, 2),\n    height: '100%',\n    position: 'absolute',\n    pointerEvents: 'none',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  inputRoot: {\n    color: 'inherit'\n  },\n  inputInput: {\n    padding: theme.spacing(1, 1, 1, 0),\n    // vertical padding + font size from searchIcon\n    paddingLeft: `calc(1em + ${theme.spacing(4)}px)`,\n    transition: theme.transitions.create('width'),\n    width: '100%',\n    [theme.breakpoints.up('md')]: {\n      width: '20ch'\n    }\n  },\n  sectionDesktop: {\n    display: 'none',\n    [theme.breakpoints.up('md')]: {\n      display: 'flex'\n    }\n  },\n  sectionMobile: {\n    display: 'flex',\n    [theme.breakpoints.up('md')]: {\n      display: 'none'\n    }\n  }\n});\n\nclass AppHome extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      error: false,\n      fetchingBooks: false,\n      searchValue: '',\n      errorMessage: '',\n      oldSearchValue: '',\n      hasBooks: false,\n      defaultCollection: 'books_home',\n      resultsPerPage: 10,\n      currentPage: 1,\n      collectionSearch: ''\n    };\n\n    this.doSearch = page_number => {\n      // get collection\n      const currentCollect = this.props.storeProps[this.state.defaultCollection];\n      const bookCollection = currentCollect ? currentCollect : new BookCollection();\n      let currentPage = page_number ? page_number : bookCollection.currentPage;\n      let searchIndex = (currentPage - 1) * this.state.resultsPerPage;\n      const oldSearchValue = this.state.oldSearchValue;\n      this.setState({\n        error: false\n      });\n      const searchValue = this.state.searchValue;\n\n      if (!searchValue) {\n        this.setState({\n          error: true,\n          errorMessage: BookErrors.nosearch\n        });\n        return;\n      } // reset pagination info on new search\n\n\n      if (searchValue !== oldSearchValue) {\n        searchIndex = 0;\n        currentPage = 1;\n        this.setState({\n          collectionSearch: ''\n        });\n      }\n\n      this.setState({\n        fetchingBooks: true\n      });\n      this.booksApi.searchBooks(searchValue, searchIndex).then(bookData => {\n        this.setState({\n          fetchingBooks: false\n        });\n        const bookTotal = bookData && bookData.data && bookData.data.totalItems;\n        const rawBookData = bookData && bookData.data && bookData.data.items;\n\n        if (!rawBookData) {\n          this.setState({\n            error: true,\n            errorMessage: BookErrors.nobooks\n          });\n          return;\n        }\n\n        const books = rawBookData.map(x => new BookModel(x));\n        const pageCount = Math.ceil(bookTotal / this.state.resultsPerPage);\n        this.props.updateBooks({\n          collectionName: this.state.defaultCollection,\n          books: books,\n          pageCount: pageCount > 50 ? 40 : pageCount,\n          currentPage: currentPage,\n          bookSearch: searchValue\n        }).then(() => {\n          this.setState({\n            error: false,\n            hasBooks: true,\n            oldSearchValue: searchValue\n          });\n        });\n      });\n    };\n\n    this.booksApi = new BooksApi();\n    this.favoriteApi = new FavoriteApi();\n  }\n\n  captureSearchValue(event) {\n    this.setState({\n      searchValue: event.target.value,\n      collectionSearch: event.target.value\n    });\n  }\n\n  keyPressed(event) {\n    if (event.key === 'Enter') {\n      this.doSearch();\n    }\n  }\n\n  componentDidMount() {\n    this.subscription = paginationService.getPage().subscribe(pageNumber => {\n      this.doSearch(pageNumber);\n    }); //get the favorites from the backend\n\n    this.favoriteApi.getIds().then(favorites => {\n      if (!favorites && !favorites.data) {\n        return;\n      }\n\n      this.props.setFavorites({\n        favorites: favorites.data\n      });\n    }); //check to see if our collection has any books from a previous search\n\n    const currentCollect = this.props.storeProps[this.state.defaultCollection];\n\n    if (currentCollect && currentCollect.books && currentCollect.books.length > 0) {\n      //get the search value too\n      this.setState({\n        hasBooks: true,\n        collectionSearch: currentCollect.bookSearch\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    this.subscription.unsubscribe();\n  }\n\n  render() {\n    const error = this.state.error;\n    const fetchingBooks = this.state.fetchingBooks;\n    const hasBooks = this.state.hasBooks;\n    const errorMessage = this.state.errorMessage;\n    const bookCollection = this.state.defaultCollection;\n    const {\n      classes\n    } = this.props;\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 10\n      }\n    }, /*#__PURE__*/React.createElement(AppBar, {\n      position: \"static\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Toolbar, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 12\n      }\n    }, /*#__PURE__*/React.createElement(IconButton, {\n      edge: \"start\",\n      className: classes.menuButton,\n      color: \"inherit\",\n      \"aria-label\": \"open drawer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Typography, {\n      className: classes.title,\n      variant: \"h6\",\n      noWrap: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 13\n      }\n    }, \"Search Books\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.search,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 14\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      sm: 2,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 14\n      }\n    }, /*#__PURE__*/React.createElement(Form.Control, {\n      type: \"email\",\n      placeholder: \"Search\",\n      onChange: e => this.captureSearchValue(e),\n      onKeyPress: e => this.keyPressed(e),\n      value: this.state.collectionSearch,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 16\n      }\n    })), /*#__PURE__*/React.createElement(Col, {\n      sm: 3,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 14\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      variant: \"primary\",\n      type: \"button\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 14\n      }\n    }, \"Search\")))), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.grow,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 13\n      }\n    }))))), /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }\n    }, hasBooks ? /*#__PURE__*/React.createElement(AppList, {\n      collectionToUse: bookCollection,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 22\n      }\n    }) : fetchingBooks ? /*#__PURE__*/React.createElement(Col, {\n      className: \"text-center fetching-books\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 11\n      }\n    }, \"Searching for books....\") : error ? /*#__PURE__*/React.createElement(Col, {\n      className: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 19\n      }\n    }, errorMessage) : /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 71\n      }\n    })));\n  }\n\n}\n\n;\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(useStyles)(AppHome));","map":{"version":3,"sources":["D:/Code/googlebooks/client/src/pages/home/home.jsx"],"names":["React","Component","Row","Col","Form","Button","BooksApi","BookErrors","BookModel","connect","AppList","updateBooks","setFavorites","BookCollection","paginationService","AppBar","Toolbar","IconButton","Typography","fade","withStyles","FavoriteApi","mapStateToProps","state","storeProps","key","value","Object","entries","mapDispatchToProps","dispatch","bookUpdate","Promise","resolve","reject","favorites","useStyles","theme","grow","flexGrow","menuButton","marginRight","spacing","title","display","breakpoints","up","search","position","borderRadius","shape","backgroundColor","palette","common","white","marginLeft","width","searchIcon","padding","height","pointerEvents","alignItems","justifyContent","inputRoot","color","inputInput","paddingLeft","transition","transitions","create","sectionDesktop","sectionMobile","AppHome","constructor","props","error","fetchingBooks","searchValue","errorMessage","oldSearchValue","hasBooks","defaultCollection","resultsPerPage","currentPage","collectionSearch","doSearch","page_number","currentCollect","bookCollection","searchIndex","setState","nosearch","booksApi","searchBooks","then","bookData","bookTotal","data","totalItems","rawBookData","items","nobooks","books","map","x","pageCount","Math","ceil","collectionName","bookSearch","favoriteApi","captureSearchValue","event","target","keyPressed","componentDidMount","subscription","getPage","subscribe","pageNumber","getIds","length","componentWillUnmount","unsubscribe","render","classes","e"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport {Row, Col, Form, Button} from 'react-bootstrap';\nimport BooksApi from '../../api/books.api';\nimport {BookErrors} from '../../shared/messages.error';\nimport BookModel from '../../model/book.model';\nimport {connect} from 'react-redux';\nimport AppList from '../../components/list/list';\nimport {updateBooks, setFavorites} from \"../../redux/actions\";\nimport BookCollection from \"../../model/bookcollection.model\";\nimport paginationService from \"../../services/pagination.service\";\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport Typography from '@material-ui/core/Typography';\nimport {fade, withStyles } from \"@material-ui/core/styles\";\nimport FavoriteApi from \"../../api/favorite.api\";\n\nconst mapStateToProps = (state) => {\n\tconst storeProps = {};\n\tfor (const [key, value] of Object.entries(state)){\n\t\tstoreProps[key] = value;\n\t}\n\treturn {\n\t\tstoreProps\n\t};\n};\n\nconst mapDispatchToProps = (dispatch) => ({\n\tupdateBooks: (bookUpdate) => new Promise((resolve, reject) => {\n\t\tdispatch(updateBooks(bookUpdate));\n\t\tresolve();\n\t}),\n\tsetFavorites: (favorites) => {dispatch(setFavorites(favorites))}\n});\n\nconst useStyles = theme => ({\n\tgrow: {\n\t\tflexGrow: 1,\n\t},\n\tmenuButton: {\n\t\tmarginRight: theme.spacing(2),\n\t},\n\ttitle: {\n\t\tdisplay: 'none',\n\t\t[theme.breakpoints.up('sm')]: {\n\t\t\tdisplay: 'block',\n\t\t},\n\t},\n\tsearch: {\n\t\tposition: 'relative',\n\t\tborderRadius: theme.shape.borderRadius,\n\t\tbackgroundColor: fade(theme.palette.common.white, 0.15),\n\t\t'&:hover': {\n\t\t\tbackgroundColor: fade(theme.palette.common.white, 0.25),\n\t\t},\n\t\tmarginRight: theme.spacing(2),\n\t\tmarginLeft: 0,\n\t\twidth: '100%',\n\t\t[theme.breakpoints.up('sm')]: {\n\t\t\tmarginLeft: theme.spacing(3),\n\t\t\twidth: 'auto',\n\t\t},\n\t},\n\tsearchIcon: {\n\t\tpadding: theme.spacing(0, 2),\n\t\theight: '100%',\n\t\tposition: 'absolute',\n\t\tpointerEvents: 'none',\n\t\tdisplay: 'flex',\n\t\talignItems: 'center',\n\t\tjustifyContent: 'center',\n\t},\n\tinputRoot: {\n\t\tcolor: 'inherit',\n\t},\n\tinputInput: {\n\t\tpadding: theme.spacing(1, 1, 1, 0),\n\t\t// vertical padding + font size from searchIcon\n\t\tpaddingLeft: `calc(1em + ${theme.spacing(4)}px)`,\n\t\ttransition: theme.transitions.create('width'),\n\t\twidth: '100%',\n\t\t[theme.breakpoints.up('md')]: {\n\t\t\twidth: '20ch',\n\t\t},\n\t},\n\tsectionDesktop: {\n\t\tdisplay: 'none',\n\t\t[theme.breakpoints.up('md')]: {\n\t\t\tdisplay: 'flex',\n\t\t},\n\t},\n\tsectionMobile: {\n\t\tdisplay: 'flex',\n\t\t[theme.breakpoints.up('md')]: {\n\t\t\tdisplay: 'none',\n\t\t},\n\t},\n});\n\nclass AppHome extends Component {\n     state = {\n     \terror: false,\n     \tfetchingBooks: false,\n     \tsearchValue: '',\n     \terrorMessage: '',\n     \toldSearchValue: '',\n     \thasBooks: false,\n     \tdefaultCollection: 'books_home',\n     \tresultsPerPage: 10,\n     \tcurrentPage: 1,\n     \tcollectionSearch: '',\n     };\n\n     constructor(props) {\n     \tsuper(props);\n     \tthis.booksApi = new BooksApi();\n     \tthis.favoriteApi = new FavoriteApi();\n     }\n\n     captureSearchValue(event) {\n     \tthis.setState({searchValue: event.target.value, collectionSearch: event.target.value});\n     }\n\n     keyPressed(event){\n     \tif (event.key === 'Enter') {\n     \t\tthis.doSearch();\n     \t}\n     }\n\n\n     componentDidMount() {\n     \tthis.subscription = paginationService.getPage().subscribe(pageNumber => {\n     \t\tthis.doSearch(pageNumber);\n     \t})\n     \t//get the favorites from the backend\n     \tthis.favoriteApi.getIds()\n     \t\t.then((favorites) => {\n     \t\t\tif (!favorites && !favorites.data){\n     \t\t\t\treturn;\n     \t\t\t}\n     \t\t\tthis.props.setFavorites({favorites: favorites.data});\n     \t\t});\n     \t//check to see if our collection has any books from a previous search\n     \tconst currentCollect = this.props.storeProps[this.state.defaultCollection];\n     \tif (currentCollect && currentCollect.books && currentCollect.books.length > 0){\n     \t\t//get the search value too\n     \t\tthis.setState({hasBooks: true, collectionSearch: currentCollect.bookSearch});\n     \t}\n     }\n\n     componentWillUnmount() {\n     \tthis.subscription.unsubscribe();\n     }\n\n     doSearch = (page_number) => {\n     \t// get collection\n     \tconst currentCollect = this.props.storeProps[this.state.defaultCollection];\n     \tconst bookCollection = currentCollect ? currentCollect : new BookCollection();\n     \tlet currentPage = page_number ? page_number : bookCollection.currentPage;\n     \tlet searchIndex =  (currentPage - 1) * this.state.resultsPerPage;\n     \tconst oldSearchValue = this.state.oldSearchValue;\n     \tthis.setState({error: false});\n\n     \tconst searchValue = this.state.searchValue;\n     \tif (!searchValue) {\n     \t\tthis.setState({error: true, errorMessage: BookErrors.nosearch});\n     \t\treturn;\n     \t}\n\n     \t// reset pagination info on new search\n     \tif (searchValue !== oldSearchValue) {\n     \t\tsearchIndex = 0;\n     \t\tcurrentPage = 1;\n     \t\tthis.setState({collectionSearch: ''});\n     \t}\n\n     \tthis.setState({fetchingBooks: true});\n     \tthis.booksApi.searchBooks(searchValue, searchIndex)\n     \t\t.then((bookData) => {\n     \t\t\tthis.setState({fetchingBooks: false});\n     \t\t\tconst bookTotal = bookData && bookData.data && bookData.data.totalItems;\n     \t\t\tconst rawBookData = bookData && bookData.data && bookData.data.items;\n     \t\t\tif (!rawBookData) {\n     \t\t\t\tthis.setState({error: true, errorMessage: BookErrors.nobooks});\n     \t\t\t\treturn;\n     \t\t\t}\n     \t\t\tconst books = rawBookData.map((x) => new BookModel(x));\n     \t\t\tconst pageCount = Math.ceil(bookTotal / this.state.resultsPerPage);\n     \t\t\tthis.props.updateBooks({\n     \t\t\t\tcollectionName: this.state.defaultCollection,\n     \t\t\t\tbooks: books,\n     \t\t\t\tpageCount: pageCount > 50 ? 40 : pageCount,\n     \t\t\t\tcurrentPage: currentPage,\n     \t\t\t\tbookSearch: searchValue,\n     \t\t\t}).then(() => {\n     \t\t\t\tthis.setState({error: false, hasBooks: true, oldSearchValue: searchValue});\n     \t\t\t});\n\n     \t\t});\n     }\n\n     render() {\n     \tconst error = this.state.error;\n     \tconst fetchingBooks = this.state.fetchingBooks;\n     \tconst hasBooks = this.state.hasBooks;\n     \tconst errorMessage = this.state.errorMessage;\n     \tconst bookCollection = this.state.defaultCollection;\n     \tconst { classes } = this.props;\n     \treturn (\n     \t\t<React.Fragment>\n     \t\t\t<Row>\n     \t\t\t\t<Col>\n     \t\t\t\t\t<AppBar position=\"static\">\n     \t\t\t\t\t\t<Toolbar>\n     \t\t\t\t\t\t\t<IconButton\n     \t\t\t\t\t\t\t\tedge=\"start\"\n     \t\t\t\t\t\t\t\tclassName={classes.menuButton}\n     \t\t\t\t\t\t\t\tcolor=\"inherit\"\n     \t\t\t\t\t\t\t\taria-label=\"open drawer\"\n     \t\t\t\t\t\t\t>\n     \t\t\t\t\t\t\t</IconButton>\n     \t\t\t\t\t\t\t<Typography className={classes.title} variant=\"h6\" noWrap>\n\t\t\t\t\t\t\t\t\tSearch Books\n     \t\t\t\t\t\t\t</Typography>\n     \t\t\t\t\t\t\t<div className={classes.search}>\n     \t\t\t\t\t\t\t\t<Row>\n     \t\t\t\t\t\t\t\t<Col sm={2}>\n     \t\t\t\t\t\t\t\t\t\t<Form.Control type=\"email\" placeholder=\"Search\" onChange={(e) => this.captureSearchValue(e)}\n\t\t\t\t\t\t\t\t\t\t\t    onKeyPress={(e) => this.keyPressed(e)} value={this.state.collectionSearch} />\n     \t\t\t\t\t\t\t\t</Col>\n     \t\t\t\t\t\t\t\t<Col sm={3}>\n     \t\t\t\t\t\t\t\t<Button variant=\"primary\" type=\"button\">\n\t\t\t\t\t\t\t\t\t\tSearch\n     \t\t\t\t\t\t\t\t</Button>\n     \t\t\t\t\t\t\t\t</Col>\n     \t\t\t\t\t\t\t\t</Row>\n     \t\t\t\t\t\t\t</div>\n     \t\t\t\t\t\t\t<div className={classes.grow} />\n     \t\t\t\t\t\t</Toolbar>\n     \t\t\t\t\t</AppBar>\n     \t\t\t\t</Col>\n     \t\t\t</Row>\n     \t\t\t<Row>\n     \t\t\t\t{hasBooks ? <AppList collectionToUse = {bookCollection}/> : fetchingBooks ?\n     \t\t\t\t\t<Col className=\"text-center fetching-books\">Searching for books....</Col> :\n     \t\t\t\t\terror ? <Col className=\"text-center\">{errorMessage}</Col> : <Col/>}\n     \t\t\t</Row>\n     \t\t</React.Fragment>);\n     }\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(useStyles)(AppHome));\n"]},"metadata":{},"sourceType":"module"}